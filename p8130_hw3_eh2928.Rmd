---
title: "Homework 3, P8130"
author: "Emil Hafeez (eh2928)"
date: "10/15/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r results = 'hide', warning = FALSE}
library(tidyverse)

exercise_df =
  read_csv(
      "./data/exercise.csv")
```

# Problem 1

For each question, make sure to state the formulae for hypotheses, test-statistics, decision rules/p-values, and provide interpretations in the context of the problem. Use a type I error of 0.05 for all tests.

### Problem 1.a

Perform appropriate tests to assess if the Systolic BP at 6 months is significantly different from the baseline values for the intervention group.

********Check for normality, consider a bonferroni adjustment, state that it's a a paired two-tailed test using an estimate. Then provide the formulas for the test statistic needed, critical value needed, the value, and then get these. and then interpret in context.********


H0, HA, mu1, mu2, test statistic formula, critical value needed, interpret



#### Problem 1.a.i

In order to determine an appropriate test, we check for normality using visual inspection of the plot of systolic blood pressure in the Intervention group at both baseline and endline, using raw data. This is explored in Problem 1.c.i and utilizes mean $\mu_{pre}$ and $\mu_{post}$ respectively. 

We first consider the changes in the intervention group between Baseline and Endline first. We determine, given that these are the same patients with data collected at two different timepoints and we do not have reason to test a specific directionality, to use a two-sided Paired t-test. 

The $H_0$ is that $\mu_{pre} -\mu_{post} = 0$ or $\Delta = 0$. The $H_A$ is $\mu_{pre} -\mu_{post} \neq 0$ or $\Delta \neq 0$.

The test statistic is $t=\frac{\overline d-0}{s_{d} / \sqrt{n}}$ where $\overline d$ is the point estimate of the mean difference, $s_{d} / \sqrt{n}$ is the estimated standard error of the differences, and we use the critical value of $t_{n-1,1-{\alpha/2}}$. We could use a Bonferroni correction or Tukey's, considering that we will be implementing multiple significance tests, but we say it is not necessary for the case of this homework problem. Additionally, the standard deviation for the difference between Baseline and Endline is given and thus the variance is known. 

Using $t=\frac{\overline d-0}{s_{d} / \sqrt{n}}$ = $t=\frac{-8.58 -0}{17.17/ \sqrt{36}}$ = $t=\frac{-8.58}{17.17/ \sqrt{36}}$ $\approx -2.99825$. The critical value is given the the percentile of the t distribution with (n-1) degrees of freedom, `qt(0.975,35)` $\approx$  $2.03$, such that we find evidence to reject the null hypothesis and conclude that in the intervention group, the mean systolic blood pressure at Endline is significantly different than the mean systolic blood pressure at Baseline. 


#### Problem 1.a.ii

Similarly, in order to determine an appropriate test, we check for normality using visual inspection of the plot of systolic blood pressure in the Control group at both Baseline and Endline, using raw data. This is explored in Problem 1.c.i and utilizes mean $\mu_{pre}$ and $\mu_{post}$ respectively. 

We determine, given that these are the same patients with data collected at two different timepoints and we do not have reason to test a specific directionality, to use a two-sided Paired t-test. 

The $H_0$ is that $\mu_{pre} -\mu_{post} = 0$ or $\Delta = 0$. The $H_A$ is $\mu_{pre} -\mu_{post} \neq 0$ or $\Delta \neq 0$.

The test statistic is $t=\frac{\overline d-0}{s_{d} / \sqrt{n}}$ where $\overline d$ is the point estimate of the mean difference, $s_{d} / \sqrt{n}$ is the estimated standard error of the differences, and we use the critical value of $t_{n-1,1-{\alpha/2}}$. We could use a Bonferroni correction, Tukey's or others, considering that we will be implementing multiple significance tests, but we say it is not necessary for the case of this homework problem. Additionally, the standard deviation for the difference between Baseline and Endline is given and thus the variance is known.  

Using $t=\frac{\overline d-0}{s_{d} / \sqrt{n}}$ = $t=\frac{-3.33 -0}{14.81/ \sqrt{36}}$  $\approx - 1.3491$. The critical value is given the the percentile of the t distribution with (n-1) degrees of freedom, `qt(0.975,35)` $\approx$  $2.03$, such that we fail to reject the null hypothesis and conclude that in the Control group, the mean systolic blood pressure at Endline is not significantly different than the mean systolic blood pressure at Baseline. 


#### Problem 1.b

Now, we assess the systolic blood pressure absolute changes between the two groups using an independent, two-sampled t-test. We assume independence based on the given information on the sampling mechanism. Since we do not know the two population variances, we first check for equality of variances. 

The statistic is given by F= $\frac{s_1^2}{s_s^2}$ , where the null hypothesis is $\sigma_1^2 = \sigma^2_2$, and the alternate hypothesis is $\sigma_1^2 \neq \sigma^2_2$ . In our case, we use F= $\frac{14.81^2}{17.17^2}$  = 0.74399 and the critical value is `qf(0.975, 35, 35)`= 1.961, such that we fail to reject the null hypothesis and conclude that the variance of sample 1 is not significantly different from the variance of sample 2. 

We use the pooled estimate of the variance (and associated standard deviation) from two independent samples given by: $s^{2}=\frac{\left(n_{1}-1\right) s_{1}^{2}+\left(n_{2}-1\right) s_{2}^{2}}{\left(n_{1}+n_{2}-2\right)}$ = $s^{2}$ = $\frac{(35) s_{1}^{2}+(35) s_{2}^{2}}{68}$ = $\frac{(35)(14.81^2)+(35)(17.17^2)}{70}$ = 257.0725 and $s= \sqrt{257.0725} = 16.0335$

So, we can proceed with the independent two sampled t-test assuming equal variances. 

Given the null hypothesis $H_0$: $\mu_{control} = \mu_{intervention}$ and the alternate, $H_A$: $\mu_{control} \neq \mu_{intervention}$, we use t = $\frac{\overline X_1 - \overline X_2}{s \sqrt {\frac {1}{n_1} + \frac{1}{n_2}}}$ $\sim$ $t_{n_1+n_2-2}$ under $H_0$

Computing this, we have t = $\frac{-3.33 - (-8.58)}{s \sqrt {\frac {1}{36} + \frac{1}{36}}}$ = $\frac{5.25}{s \sqrt{0.055}}$ = 1.3892. We can also use std_pooled<-sqrt(((14.81^2(35))+(17.17^2(35)))/70) and `t_stats<-(-3.33-(-8.58))/(std_pooled*sqrt((1/36)+(1/36)))`. The critical value is given by $t_{n_1+n_2-2, 0.975}$ = `qt(0.975,70)` = 1.994437. Therefore, we fail to reject the null hypothesis and conclude that the difference in mean systolic blood pressure change from Baseline to Endline in the Control group is not significantly different from the mean systolic blood pressure change from Baseline to Endline in the Intervention group. 

For the confidence interval,

\begin{equation}
\left(\overline{X_{1}}-\overline{X_{2}}-t_{n_{1}+n_{2}-2,1-\alpha / 2} \cdot s \cdot \sqrt{1 / n_{1}+1 / n_{2}}, \overline{X_{1}}-\overline{X_{2}}+t_{n_{1}+n_{2}-2,1-\alpha / 2} \cdot s \cdot \sqrt{1 / n_{1}+1 / n_{2}}\right)
\end{equation}


This is to say, the lower limit of the 95% CI is 5.25 - \(t_{n_1+n_2-2, 1 - \alpha}\) * \(s \sqrt {\frac {1}{36} + \frac{1}{36}}\) = = $5.25 - 22.27386 = -17.02386$ and the upper limit of the confidence interval is (-3.33 - (-8.58)) \(+ t_{n_{1}+n_{2}-2,1-\alpha} * s \sqrt {\frac {1}{36} + \frac{1}{36}}\) =  $5.25 + 22.27386 = 27.52386$, thus the 95% CI is (-17.02386, 27.52386). 


### Problem 1.c

#### Problem 1.c.i

The main assumptions for part a) the two-sided paired t-test, are that we assume the systolic blood pressure measurements are normally distributed with mean $\mu_{baseline}$ $\mu_{endline}$, and that these differences also follow a normal distribution. We therefore also assume that the observed SBP differences constitute a random sample from this normally distributed population of differences. We're assuming the sampled patients have been drawn randomly, and also that each of their sampling is independent from another. We also assume that the variance is known (based on the provided standard deviation; I am also assuming this provided standard deviation was adjusted for the paired t-test (it's already been divided by the square root of (n-1)). 

The main assumptions for part b) the two-sided two-sample independent t-test assumes similarly as part a) regarding independence and normality, and then regarding variance instead assume the homogeneity of variance (which we tested with an F-test). 

Now, we can examine the normality assumption using graphical displays, for the Intervention group systolic blood pressures at Baseline and at Endline, and  similarly for the Control group. 
```{r}
#plot of intervention at baseline to examine normality
exercise_df %>%
  ggplot(aes(x = Systolic_PRE)) +
  geom_histogram(binwidth = 8, fill = "grey", colour = "grey", alpha = 0.8) +
  labs(
    x = "Systolic Blood Pressure at Baseline",
    y = "Density",
    title = "Histogram and Density Curve for the Original Normal Data") +
  scale_fill_viridis_d("") +
  theme(legend.position = "none")
```
```{r}
#plot of intervention at endline to examine normality
exercise_df %>%
  ggplot(aes(x = Systolic_POST)) +
  geom_histogram(binwidth = 8, fill = "grey", colour = "grey", alpha = 0.8) +
  labs(
    x = "Systolic Blood Pressure at Baseline",
    y = "Density",
    title = "Histogram and Density Curve for the Original Normal Data") +
  scale_fill_viridis_d("") +
  theme(legend.position = "none")
```

DISCUSS
#### Problem 1.c.ii






